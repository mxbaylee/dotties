#!/bin/bash

# ğŸ”„ Repeatedly runs a command with optional delay between executions.
#
# Usage:
#   infinite         command  # Run continuously â™¾ï¸
#   infinite 5       command  # Run every 5 seconds â°
#
# Example:
#   infinite 2 date         # Run `date` every 2 seconds ğŸ“…
#   infinite 2 npm run dev  # Run `npm run dev`, restart it every 2s after it exits ğŸš€

show_help() {
  cat << EOF
ğŸ”„ infinite - Command Repeater Tool

Usage: infinite [OPTIONS] [DELAY] COMMAND

Repeatedly runs a command with optional delay between executions.

OPTIONS:
  -h, --help    Show this help message and exit ğŸ“–

ARGUMENTS:
  DELAY         Number of seconds to wait between command executions (default: 0) â±ï¸
  COMMAND       The command to run repeatedly ğŸ”§

EXAMPLES:
  infinite date                   # Run 'date' continuously â™¾ï¸
  infinite 5 date                 # Run 'date' every 5 seconds â°
  infinite 2 npm run dev          # Run 'npm run dev', restart every 2s after exit ğŸš€
  infinite --help                 # Show this help message ğŸ“š

EOF
}

is_number() {
  [[ "$1" =~ ^[0-9]+$ ]]
}

# Check for help flags ğŸ†˜
if [[ "$1" == "--help" || "$1" == "-h" ]]; then
  show_help
  exit 0
fi

sleep_time=${1}
if ! is_number "$sleep_time"; then
  sleep_time=0
else
  shift
fi

command="$@"

# Infinite loop starts here! ğŸ”„
while true; do
  eval "$command"
  sleep $sleep_time
done
